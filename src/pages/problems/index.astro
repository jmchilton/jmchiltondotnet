---
import BaseLayout from '../../layouts/BaseLayout.astro';
import TerminalPrompt from '../../components/TerminalPrompt.astro';
import TagBadge from '../../components/TagBadge.astro';
import { getCollection } from 'astro:content';

// Get all problems, sorted by start date (oldest first - longest-running problems)
const allProblems = await getCollection('problems');
const sortedProblems = allProblems.sort(
  (a, b) => new Date(a.data.started).getTime() - new Date(b.data.started).getTime()
);
---

<BaseLayout
  title="Problems"
  description="The questions I keep coming back to - problems worth solving."
>
  <TerminalPrompt command="cat problems.txt">
    <div class="mb-6">
      <h1 class="mb-4 font-mono text-3xl font-bold text-terminal-text">Problems</h1>
      <blockquote
        class="border-l-4 border-terminal-border pl-4 italic text-terminal-text-secondary"
      >
        <p class="mb-2">
          "You have to keep a dozen of your favorite problems constantly present in your mind,
          although by and large they will lay in a dormant state. Every time you hear or read a new
          trick or a new result, test it against each of your twelve problems to see whether it
          helps. Every once in a while there will be a hit, and people will say, 'How did he do it?
          He must be a genius!'"
        </p>
        <footer class="text-terminal-sm not-italic text-terminal-text-muted">
          â€” Richard Feynman, Nobel Prize-winning physicist
        </footer>
      </blockquote>
    </div>

    {/* Problem count */}
    <div class="mb-6 font-mono text-terminal-sm text-terminal-text-muted">
      {sortedProblems.length}
      {sortedProblems.length === 1 ? 'problem' : 'problems'}
    </div>

    {/* Problem list */}
    <div class="space-y-6">
      {
        sortedProblems.map((problem) => (
          <article class="terminal-card">
            <div class="mb-2 flex items-center gap-2">
              <span class="font-mono text-terminal-sm text-terminal-text-muted">
                since {problem.data.started}
              </span>
            </div>
            <h2 class="mb-2 font-mono text-xl font-semibold">
              <a href={`/problems/${problem.slug}`} class="terminal-link">
                {problem.data.title}
              </a>
            </h2>
            <p class="mb-3 text-terminal-text-secondary">{problem.data.description}</p>
            <div class="flex flex-wrap gap-2">
              {problem.data.tags.map((tag) => (
                <TagBadge tag={tag} />
              ))}
            </div>
          </article>
        ))
      }
    </div>

    {/* Empty state */}
    {
      sortedProblems.length === 0 && (
        <div class="rounded border border-terminal-border bg-terminal-bg-alt p-8 text-center">
          <p class="font-mono text-terminal-text-secondary">No problems defined yet.</p>
        </div>
      )
    }
  </TerminalPrompt>
</BaseLayout>
