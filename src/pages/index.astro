---
import BaseLayout from '../layouts/BaseLayout.astro';
import TerminalPrompt from '../components/TerminalPrompt.astro';
import TagBadge from '../components/TagBadge.astro';
import { getCollection } from 'astro:content';

// Get featured problems (or all if none featured, limit to 3)
const allProblems = await getCollection('problems');
const featuredProblems = allProblems.filter((p) => p.data.featured);
const displayProblems = (featuredProblems.length > 0 ? featuredProblems : allProblems)
  .sort((a, b) => new Date(a.data.started).getTime() - new Date(b.data.started).getTime())
  .slice(0, 3);
---

<BaseLayout>
  {/* Hero Section */}
  <section class="mb-12">
    <TerminalPrompt command="whoami">
      <div class="space-y-4">
        <h1 class="font-mono text-3xl font-bold text-terminal-text md:text-4xl">John Chilton</h1>
        <p class="text-lg leading-relaxed text-terminal-text-secondary">
          Software developer and researcher. I keep a handful of problems in mind and test new ideas
          against them. This site tracks those problems and the work they've generated.
        </p>
        <div class="flex flex-wrap gap-3">
          <span class="terminal-badge-blue">Python</span>
          <span class="terminal-badge-purple">Galaxy Project</span>
          <span class="terminal-badge-green">Open Source</span>
          <span class="terminal-badge-yellow">Bioinformatics</span>
        </div>
      </div>
    </TerminalPrompt>
  </section>

  {/* Featured Problems */}
  <section class="mb-12">
    <TerminalPrompt command="cat problems.txt">
      <div class="space-y-6">
        {
          displayProblems.map((problem) => (
            <article class="terminal-card">
              <div class="mb-2">
                <span class="font-mono text-terminal-sm text-terminal-text-muted">
                  since {problem.data.started}
                </span>
              </div>
              <h2 class="mb-2 font-mono text-xl font-semibold">
                <a href={`/problems/${problem.slug}`} class="terminal-link">
                  {problem.data.title}
                </a>
              </h2>
              <p class="mb-3 text-terminal-text-secondary">{problem.data.description}</p>
              <div class="flex flex-wrap gap-2">
                {problem.data.tags.map((tag) => (
                  <TagBadge tag={tag} />
                ))}
              </div>
            </article>
          ))
        }
      </div>

      {
        displayProblems.length > 0 && (
          <div class="mt-6">
            <a href="/problems" class="terminal-button-primary">
              View all problems â†’
            </a>
          </div>
        )
      }
    </TerminalPrompt>
  </section>

  {/* Navigation Cards */}
  <section class="mb-12">
    <TerminalPrompt command="ls -l">
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        <a href="/problems" class="terminal-card block">
          <h3 class="mb-2 font-mono text-lg font-semibold text-terminal-blue">problems/</h3>
          <p class="text-terminal-sm text-terminal-text-secondary">
            Questions I keep coming back to
          </p>
        </a>

        <a href="/timeline" class="terminal-card block">
          <h3 class="mb-2 font-mono text-lg font-semibold text-terminal-blue">timeline/</h3>
          <p class="text-terminal-sm text-terminal-text-secondary">
            PRs, papers, presentations, and projects
          </p>
        </a>

        <a href="/about" class="terminal-card block">
          <h3 class="mb-2 font-mono text-lg font-semibold text-terminal-blue">about/</h3>
          <p class="text-terminal-sm text-terminal-text-secondary">
            Background, skills, and interests
          </p>
        </a>

        <a href="/best-of-pittsburgh" class="terminal-card block">
          <h3 class="mb-2 font-mono text-lg font-semibold text-terminal-blue">
            best-of-pittsburgh/
          </h3>
          <p class="text-terminal-sm text-terminal-text-secondary">
            Best food, drinks, and fun in Pittsburgh
          </p>
        </a>

        <a href="/cocktails" class="terminal-card block">
          <h3 class="mb-2 font-mono text-lg font-semibold text-terminal-blue">cocktails/</h3>
          <p class="text-terminal-sm text-terminal-text-secondary">Recipes and experiments</p>
        </a>

        <a href="/resume.pdf" class="terminal-card block">
          <h3 class="mb-2 font-mono text-lg font-semibold text-terminal-text">resume.pdf</h3>
          <p class="text-terminal-sm text-terminal-text-secondary">Professional resume (PDF)</p>
        </a>

        <a href="/cv.pdf" class="terminal-card block">
          <h3 class="mb-2 font-mono text-lg font-semibold text-terminal-text">cv.pdf</h3>
          <p class="text-terminal-sm text-terminal-text-secondary">Academic CV (PDF)</p>
        </a>
      </div>
    </TerminalPrompt>
  </section>

  {/* Quick Links */}
  <section>
    <TerminalPrompt command="cat contact.txt">
      <div class="space-y-2 font-mono text-terminal-sm">
        <p>
          <span class="text-terminal-text-secondary">GitHub:</span>
          <a href="https://github.com/jmchilton" class="terminal-link ml-2">@jmchilton</a>
        </p>
        <p>
          <span class="text-terminal-text-secondary">Email:</span>
          <a href="mailto:john@jmchilton.net" class="terminal-link ml-2">john@jmchilton.net</a>
        </p>
      </div>
    </TerminalPrompt>
  </section>
</BaseLayout>
